# 网络请求失败问题排查指南

## 问题：显示"网络请求失败，请检查API Key配置"

### 第一步：检查开发者工具设置

1. 打开微信开发者工具
2. 点击右上角的"详情"按钮
3. 在"本地设置"标签页中
4. **勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
5. 重新编译运行

这是**最可能的原因**，如果勾选后能正常加载，说明是域名配置问题。

### 第二步：检查API Key配置

1. 打开 `comm/script/config.js`
2. 确认第21行的 `tmdbApiKey` 已正确配置
3. 确认API Key没有多余的空格或换行

### 第三步：查看控制台日志

在微信开发者工具的控制台中查看：

1. **请求URL**：应该类似 `https://api.themoviedb.org/3/movie/now_playing?api_key=xxx&language=zh-CN&page=1&region=CN`
2. **错误信息**：查看具体的错误提示

常见错误信息：
- `域名不在以下 request 合法域名列表中` → 需要配置域名或勾选"不校验合法域名"
- `timeout` → 网络超时，检查网络连接
- `API Key无效` → 检查API Key是否正确

### 第四步：测试API Key是否有效

在浏览器中直接访问以下URL（替换YOUR_API_KEY为你的实际API Key）：

```
https://api.themoviedb.org/3/movie/now_playing?api_key=YOUR_API_KEY&language=zh-CN&page=1
```

如果返回JSON数据，说明API Key有效。
如果返回错误信息，说明API Key有问题。

### 第五步：配置小程序合法域名（正式发布需要）

如果要在真机上测试或正式发布，必须配置合法域名：

1. 登录 [微信公众平台](https://mp.weixin.qq.com)
2. 进入"开发" -> "开发管理" -> "开发设置"
3. 在"服务器域名" -> "request合法域名"中添加：
   ```
   https://api.themoviedb.org
   https://image.tmdb.org
   ```
4. 保存后等待几分钟生效

**注意**：配置域名后，需要重新编译小程序才能生效。

## 常见问题

### Q1: 本地开发可以，真机不行
**原因**：真机必须配置合法域名
**解决**：按照第五步配置合法域名

### Q2: 一直显示"玩命加载中…"
**原因**：请求失败但没有触发错误处理
**解决**：
1. 检查控制台是否有错误
2. 确认 `showLoading` 状态是否正确更新
3. 检查网络连接

### Q3: API Key测试有效，但小程序还是失败
**原因**：可能是域名配置问题
**解决**：
1. 在开发者工具中勾选"不校验合法域名"
2. 检查控制台的具体错误信息
3. 确认API Key在config.js中正确配置

### Q4: 控制台显示"域名不在合法域名列表中"
**解决**：
- **开发阶段**：在开发者工具中勾选"不校验合法域名"
- **正式发布**：在微信公众平台配置合法域名

## 调试技巧

### 查看详细日志

代码中已经添加了详细的日志输出，在控制台可以看到：
- 请求的完整URL
- API响应数据
- 错误详细信息

### 手动测试API

使用Postman或浏览器测试TMDB API：

```bash
# 测试正在热映
curl "https://api.themoviedb.org/3/movie/now_playing?api_key=YOUR_API_KEY&language=zh-CN&page=1"

# 测试电影详情
curl "https://api.themoviedb.org/3/movie/550?api_key=YOUR_API_KEY&language=zh-CN&append_to_response=credits"
```

## 如果还是无法解决

1. 查看控制台的完整错误信息
2. 截图错误信息
3. 检查网络连接
4. 确认API Key在TMDB官网的状态是否正常

